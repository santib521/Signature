<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Signature Export 32x11mm</title>

<style>
body{
    font-family:sans-serif;
    text-align:center;
    background:#f5f5f5;
}
canvas{
    border:2px solid #000;
    background:#fff;
    touch-action:none;
}
button{
    margin:10px;
    padding:10px 20px;
    font-size:16px;
}
</style>
</head>
<body>

<h2>‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</h2>

<canvas id="pad" width="900" height="300"></canvas>
<br>
<button onclick="clearPad()">‡∏•‡πâ‡∏≤‡∏á</button>
<button onclick="exportSignature()">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PNG (32x11mm)</button>

<script>

const canvas=document.getElementById("pad");
const ctx=canvas.getContext("2d");

let drawing=false;

canvas.addEventListener("mousedown",start);
canvas.addEventListener("mousemove",draw);
canvas.addEventListener("mouseup",stop);
canvas.addEventListener("mouseout",stop);

canvas.addEventListener("touchstart",startTouch);
canvas.addEventListener("touchmove",drawTouch);
canvas.addEventListener("touchend",stop);

function getPos(e){
    const rect=canvas.getBoundingClientRect();
    return {
        x:e.clientX-rect.left,
        y:e.clientY-rect.top
    };
}

function start(e){
    drawing=true;
    ctx.beginPath();
    const pos=getPos(e);
    ctx.moveTo(pos.x,pos.y);
}

function draw(e){
    if(!drawing) return;
    const pos=getPos(e);
    ctx.lineTo(pos.x,pos.y);
    ctx.strokeStyle="#000";
    ctx.lineWidth=2.2;
    ctx.lineCap="round";
    ctx.lineJoin="round";
    ctx.stroke();
}

function stop(){
    drawing=false;
}

function startTouch(e){
    e.preventDefault();
    drawing=true;
    const touch=e.touches[0];
    const rect=canvas.getBoundingClientRect();
    ctx.beginPath();
    ctx.moveTo(touch.clientX-rect.left,touch.clientY-rect.top);
}

function drawTouch(e){
    e.preventDefault();
    if(!drawing) return;
    const touch=e.touches[0];
    const rect=canvas.getBoundingClientRect();
    ctx.lineTo(touch.clientX-rect.left,touch.clientY-rect.top);
    ctx.strokeStyle="#000";
    ctx.lineWidth=2.2;
    ctx.lineCap="round";
    ctx.lineJoin="round";
    ctx.stroke();
}

function clearPad(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
}

/* =========================
   EXPORT FIXED REAL SIZE
========================= */

function exportSignature(){

    const targetWidth=756;   // 32mm @600dpi
    const targetHeight=260;  // 11mm @600dpi

    const realSignatureHeightMM=7;   // üî• ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á
    const dpi=600;
    const fixedHeightPx=Math.round((realSignatureHeightMM/25.4)*dpi);

    const img=ctx.getImageData(0,0,canvas.width,canvas.height);
    const data=img.data;

    let minX=canvas.width, minY=canvas.height, maxX=0, maxY=0;
    let found=false;

    for(let y=0;y<canvas.height;y++){
        for(let x=0;x<canvas.width;x++){
            const i=(y*canvas.width+x)*4;
            if(data[i+3]>0){
                found=true;
                if(x<minX)minX=x;
                if(y<minY)minY=y;
                if(x>maxX)maxX=x;
                if(y>maxY)maxY=y;
            }
        }
    }

    if(!found){
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô");
        return;
    }

    const cropW=maxX-minX;
    const cropH=maxY-minY;

    const scale=fixedHeightPx/cropH;

    const drawW=cropW*scale;
    const drawH=cropH*scale;

    const outCanvas=document.createElement("canvas");
    outCanvas.width=targetWidth;
    outCanvas.height=targetHeight;
    const outCtx=outCanvas.getContext("2d");

    const offsetX=(targetWidth-drawW)/2;
    const offsetY=(targetHeight-drawH)/2;

    outCtx.drawImage(
        canvas,
        minX,minY,cropW,cropH,
        offsetX,offsetY,drawW,drawH
    );

    const link=document.createElement("a");
    link.download="signature_32x11mm.png";
    link.href=outCanvas.toDataURL("image/png");
    link.click();
}

</script>

</body>
</html>