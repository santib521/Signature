<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Doctor Signature System PRO</title>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
:root{
    --primary:#2563eb;
    --success:#16a34a;
    --danger:#dc2626;
    --bg:#eef2f7;
    --card:#ffffff;
    --border:#e2e8f0;
}

*{box-sizing:border-box;}

body{
    margin:0;
    font-family:Segoe UI, Roboto, sans-serif;
    background:var(--bg);
}

.header{
    background:var(--primary);
    color:white;
    padding:16px;
    text-align:center;
    font-weight:600;
}

.control-panel{
    background:var(--card);
    padding:15px;
    display:flex;
    flex-wrap:wrap;
    gap:20px;
    justify-content:center;
}

.size-options{
    display:flex;
    gap:15px;
}

.size-box{
    cursor:pointer;
    padding:6px 12px;
    border-radius:8px;
    border:2px solid var(--border);
    text-align:center;
}

.size-box.active{
    border:2px solid var(--primary);
    background:#f0f6ff;
}

.size-line{
    margin-top:4px;
    border-radius:4px;
    background:black;
}

.container{
    display:flex;
    flex-direction:column;
    gap:20px;
    padding:15px;
}

.card{
    background:var(--card);
    padding:15px;
    border-radius:14px;
}

canvas{
    width:100%;
    height:220px;
    border-radius:12px;
    border:1px solid var(--border);
    background:white;
    touch-action:none;
}

button{
    padding:10px 20px;
    border:none;
    border-radius:8px;
    cursor:pointer;
}

.btn-clear{ background:var(--danger); color:white; }

.footer{
    background:white;
    padding:15px;
    position:sticky;
    bottom:0;
    display:flex;
    gap:10px;
}

#fileName{
    flex:1;
    padding:10px;
    border-radius:8px;
    border:1px solid var(--border);
}

.btn-save{
    background:var(--success);
    color:white;
}

@media(min-width:900px){
    .container{ flex-direction:row; }
    .card{ flex:1; }
}
</style>
</head>

<body>

<div class="header">Doctor Signature System â€¢ PRO Quality</div>

<div class="control-panel">
    <div>
        <div>Pen Size</div>
        <div class="size-options">
            <div class="size-box" data-size="small">
                Small
                <div class="size-line" style="height:2px;"></div>
            </div>
            <div class="size-box active" data-size="medium">
                Medium
                <div class="size-line" style="height:4px;"></div>
            </div>
            <div class="size-box" data-size="large">
                Large
                <div class="size-line" style="height:6px;"></div>
            </div>
        </div>
    </div>
</div>

<div class="container">

<div class="card">
<h3>Thai Signature</h3>
<canvas id="thaiPad"></canvas>
<button class="btn-clear" onclick="thaiPad.clear()">Clear</button>
</div>

<div class="card">
<h3>English Signature</h3>
<canvas id="engPad"></canvas>
<button class="btn-clear" onclick="engPad.clear()">Clear</button>
</div>

</div>

<div class="footer">
<input type="text" id="fileName" placeholder="File name">
<button class="btn-save" onclick="saveSignatures()">Save</button>
</div>

<script>

// Retina Quality Canvas
function resizeCanvas(canvas){
    const ratio = Math.max(window.devicePixelRatio || 1, 2);
    const rect = canvas.getBoundingClientRect();

    canvas.width = rect.width * ratio;
    canvas.height = rect.height * ratio;

    const ctx = canvas.getContext("2d");
    ctx.scale(ratio, ratio);
    ctx.lineCap="round";
    ctx.lineJoin="round";
}

// Create Signature Pad
function createPad(id){
    const canvas=document.getElementById(id);
    resizeCanvas(canvas);

    return new SignaturePad(canvas,{
        minWidth:1.8,
        maxWidth:3.2,
        velocityFilterWeight:0.7,
        throttle:8,
        minDistance:0.5
    });
}

const thaiPad=createPad("thaiPad");
const engPad=createPad("engPad");

window.addEventListener("resize",()=>{
    resizeCanvas(thaiPad.canvas);
    resizeCanvas(engPad.canvas);
});

// Pen Size
function setSize(size){
    let min,max;
    if(size==="small"){ min=1.2; max=2; }
    if(size==="medium"){ min=1.8; max=3.2; }
    if(size==="large"){ min=2.8; max=4.5; }

    thaiPad.minWidth=min;
    thaiPad.maxWidth=max;
    engPad.minWidth=min;
    engPad.maxWidth=max;
}

setSize("medium");

document.querySelectorAll(".size-box").forEach(b=>{
    b.addEventListener("click",function(){
        document.querySelectorAll(".size-box").forEach(x=>x.classList.remove("active"));
        this.classList.add("active");
        setSize(this.dataset.size);
    });
});

// Crop + Scale Professional Export
function generatePNG(pad){

    const targetWidth=1600;
    const targetHeight=600;

    const src=pad.canvas;
    const ctx=src.getContext("2d");
    const img=ctx.getImageData(0,0,src.width,src.height);
    const data=img.data;

    let minX=src.width,minY=src.height,maxX=0,maxY=0,found=false;

    for(let y=0;y<src.height;y++){
        for(let x=0;x<src.width;x++){
            const i=(y*src.width+x)*4;
            if(data[i+3]>0){
                found=true;
                if(x<minX)minX=x;
                if(y<minY)minY=y;
                if(x>maxX)maxX=x;
                if(y>maxY)maxY=y;
            }
        }
    }

    if(!found) return null;

    const cropW=maxX-minX;
    const cropH=maxY-minY;

    const out=document.createElement("canvas");
    out.width=targetWidth;
    out.height=targetHeight;
    const octx=out.getContext("2d");

    const scale=Math.min(
        (targetWidth*0.27)/cropW,
        (targetHeight*0.32)/cropH
    );

    const drawW=cropW*scale;
    const drawH=cropH*scale;

    const offX=(targetWidth-drawW)/2;
    const offY=(targetHeight-drawH)/2;

    octx.shadowColor="rgba(0,0,0,0.15)";
    octx.shadowBlur=3;

    octx.drawImage(src,minX,minY,cropW,cropH,offX,offY,drawW,drawH);

    return out.toDataURL("image/png");
}

// Save
function saveSignatures(){
    const name=document.getElementById("fileName").value.trim();
    if(name==="") return alert("Enter file name");

    const th=!thaiPad.isEmpty()?generatePNG(thaiPad):null;
    const en=!engPad.isEmpty()?generatePNG(engPad):null;

    if(th && !en){ download(th,name+"_Th.png"); return; }
    if(!th && en){ download(en,name+"_Eng.png"); return; }

    if(th && en){
        const zip=new JSZip();
        zip.file(name+"_Th.png",th.split(',')[1],{base64:true});
        zip.file(name+"_Eng.png",en.split(',')[1],{base64:true});
        zip.generateAsync({type:"blob"}).then(c=>{
            const link=document.createElement("a");
            link.href=URL.createObjectURL(c);
            link.download=name+"_Signatures.zip";
            link.click();
        });
    }
}

function download(data,name){
    const a=document.createElement("a");
    a.href=data;
    a.download=name;
    a.click();
}

</script>
</body>
</html>