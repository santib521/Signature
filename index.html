<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Signature 32x11mm (600 DPI Stable)</title>

<style>
body{
    font-family:sans-serif;
    text-align:center;
    background:#f4f4f4;
    margin:20px;
}

.container{
    width:100%;
    max-width:800px;
    margin:auto;
}

.canvas-box{
    position:relative;
    width:100%;
    aspect-ratio: 32 / 11;   /* üî• ‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏£‡∏¥‡∏á */
    border:2px solid #000;
    background:#fff;
}

canvas{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    touch-action:none;
}

button{
    margin:10px;
    padding:10px 20px;
    font-size:16px;
}
</style>
</head>
<body>

<div class="container">
<h3>‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</h3>

<div class="canvas-box">
    <canvas id="pad"></canvas>
</div>

<br>
<button onclick="clearPad()">‡∏•‡πâ‡∏≤‡∏á</button>
<button onclick="exportSignature()">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PNG (32x11mm)</button>
</div>

<script>
const canvas = document.getElementById("pad");
const ctx = canvas.getContext("2d");

function setupCanvas(){
    const ratio = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();

    canvas.width = rect.width * ratio;
    canvas.height = rect.height * ratio;

    ctx.setTransform(ratio,0,0,ratio,0,0); // üî• reset scale ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
}

setupCanvas();
window.addEventListener("resize", setupCanvas);

// ===== Drawing =====

let drawing=false;

function getPos(e){
    const rect = canvas.getBoundingClientRect();
    return {
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
    };
}

canvas.addEventListener("pointerdown", e=>{
    drawing=true;
    ctx.beginPath();
    const p=getPos(e);
    ctx.moveTo(p.x,p.y);
});

canvas.addEventListener("pointermove", e=>{
    if(!drawing) return;
    const p=getPos(e);
    ctx.lineTo(p.x,p.y);
    ctx.strokeStyle="#000";
    ctx.lineWidth=2;
    ctx.lineCap="round";
    ctx.lineJoin="round";
    ctx.stroke();
});

canvas.addEventListener("pointerup", ()=>drawing=false);
canvas.addEventListener("pointerleave", ()=>drawing=false);

function clearPad(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
}

// ===== EXPORT 600 DPI REAL =====

function exportSignature(){

    const targetW=756;  // 32mm @600dpi
    const targetH=260;  // 11mm @600dpi
    const maxHeightMM=6;
    const dpi=600;
    const maxHeightPx=Math.round((maxHeightMM/25.4)*dpi);

    const img=ctx.getImageData(0,0,canvas.width,canvas.height);
    const data=img.data;

    let minX=canvas.width, minY=canvas.height, maxX=0, maxY=0;
    let found=false;

    for(let y=0;y<canvas.height;y++){
        for(let x=0;x<canvas.width;x++){
            const i=(y*canvas.width+x)*4;
            if(data[i+3]>10){
                found=true;
                if(x<minX)minX=x;
                if(y<minY)minY=y;
                if(x>maxX)maxX=x;
                if(y>maxY)maxY=y;
            }
        }
    }

    if(!found) return;

    const cropW=maxX-minX;
    const cropH=maxY-minY;

    const scale=maxHeightPx/cropH;

    const drawW=cropW*scale;
    const drawH=cropH*scale;

    const out=document.createElement("canvas");
    out.width=targetW;
    out.height=targetH;
    const octx=out.getContext("2d");

    const offsetX=(targetW-drawW)/2;
    const offsetY=(targetH-drawH)/2;

    octx.drawImage(
        canvas,
        minX,minY,cropW,cropH,
        offsetX,offsetY,drawW,drawH
    );

    const link=document.createElement("a");
    link.download="signature_32x11mm_600dpi.png";
    link.href=out.toDataURL("image/png");
    link.click();
}
</script>

</body>
</html>